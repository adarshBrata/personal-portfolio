---
import { getCollection } from 'astro:content';
import Layout from '../../Layout/Layout.astro';

export async function getStaticPaths() {
  const posts = await getCollection('blog');
  return posts.map((post) => ({
    params: { slug: post.slug },
    props: post,
  }));
}

const post = Astro.props;
const { Content } = await post.render();

const formattedDate = new Date(post.data.pubDate).toLocaleDateString('en-US', {
  year: 'numeric',
  month: 'long',
  day: 'numeric',
});
---

<Layout>
    <!-- Back to Blog Button -->
    <div class="max-w-4xl mx-auto px-4 sm:px-6 md:px-8 pt-4 pb-2">
        <a 
            href="/blog" 
            class="inline-flex items-center gap-2 text-amber-400 hover:text-amber-300 transition-all duration-300 font-semibold text-sm group bg-zinc-800/50 px-4 py-2 rounded-full border border-zinc-700/50 hover:border-amber-500/50 backdrop-blur-sm"
        >
            <span class="group-hover:-translate-x-1 transition-transform duration-300">‚Üê</span>
            <span>Back to Blog</span>
        </a>
    </div>

    <article class="max-w-4xl mx-auto px-4 sm:px-6 md:px-8 py-8 md:py-12">
        <!-- Hero Image -->
        {post.data.heroImage && (
            <div id="article-hero" class="aspect-video overflow-hidden rounded-2xl mb-6 md:mb-8 shadow-2xl border border-zinc-700/50">
                <img 
                    src={post.data.heroImage} 
                    alt={post.data.title}
                    class="w-full h-full object-cover hover:scale-105 transition-transform duration-700"
                />
            </div>
        )}

        <!-- Article Header -->
        <header class="mb-6 md:mb-8">
            <div id="article-tags" class="flex flex-wrap gap-2 mb-6">
                {post.data.tags.map((tag: string) => (
                    <span class="px-4 py-2 text-sm rounded-full bg-gradient-to-r from-amber-500/20 to-amber-300/20 text-amber-200 border border-amber-500/30 font-semibold backdrop-blur-sm hover:from-amber-500/30 hover:to-amber-300/30 transition-all duration-300">
                        {tag}
                    </span>
                ))}
            </div>
            
            <h1 id="article-title" class="text-3xl sm:text-4xl md:text-5xl lg:text-6xl font-bold text-zinc-100 mb-6 leading-tight bg-gradient-to-r from-zinc-100 via-white to-zinc-200 bg-clip-text text-transparent">
                {post.data.title}
            </h1>
            
            <p id="article-description" class="text-lg sm:text-xl md:text-2xl text-zinc-300 mb-8 leading-relaxed font-light">
                {post.data.description}
            </p>
            
            <div id="article-meta" class="flex items-center gap-6 text-zinc-400 pb-8 border-b border-zinc-700/50">
                <time class="text-sm font-medium bg-zinc-800/50 px-4 py-2 rounded-full border border-zinc-700/50">
                    üìÖ {formattedDate}
                </time>
                {post.data.updatedDate && (
                    <span class="text-sm font-medium bg-zinc-800/50 px-4 py-2 rounded-full border border-zinc-700/50">
                        üîÑ Updated: {new Date(post.data.updatedDate).toLocaleDateString('en-US', {
                            year: 'numeric',
                            month: 'long',
                            day: 'numeric',
                        })}
                    </span>
                )}
            </div>
        </header>

        <!-- Article Content -->
        <div id="article-content" class="prose prose-invert prose-lg max-w-none">
            <Content />
        </div>
    </article>
</Layout>

<script>
    import { gsap } from 'gsap';
    import { ScrollTrigger } from 'gsap/ScrollTrigger';

    gsap.registerPlugin(ScrollTrigger);

    // Hero image animation
    gsap.fromTo('#article-hero', 
        { opacity: 0, scale: 0.8, y: 50 },
        { opacity: 1, scale: 1, y: 0, duration: 1.2, ease: "power3.out" }
    );

    // Tags animation
    gsap.fromTo('#article-tags span', 
        { opacity: 0, scale: 0, y: 20 },
        { 
            opacity: 1, 
            scale: 1, 
            y: 0, 
            duration: 0.6, 
            ease: "back.out(1.7)",
            stagger: 0.1,
            delay: 0.3
        }
    );

    // Title animation
    gsap.fromTo('#article-title', 
        { opacity: 0, y: 50 },
        { opacity: 1, y: 0, duration: 1, delay: 0.5, ease: "power3.out" }
    );

    // Description animation
    gsap.fromTo('#article-description', 
        { opacity: 0, y: 30 },
        { opacity: 1, y: 0, duration: 0.8, delay: 0.7, ease: "power3.out" }
    );

    // Meta animation
    gsap.fromTo('#article-meta', 
        { opacity: 0, y: 20 },
        { opacity: 1, y: 0, duration: 0.6, delay: 0.9, ease: "power3.out" }
    );

    // Content animation
    gsap.fromTo('#article-content', 
        { opacity: 0, y: 30 },
        { 
            opacity: 1, 
            y: 0, 
            duration: 1, 
            delay: 1.1, 
            ease: "power3.out",
            scrollTrigger: {
                trigger: '#article-content',
                start: 'top 80%'
            }
        }
    );

    // Back to blog animation
</script>

<style>
    .prose {
        color: #d1d5db;
        line-height: 1.7;
        font-size: 1rem;
        max-width: none;
    }
    
    .prose h1, .prose h2, .prose h3, .prose h4, .prose h5, .prose h6 {
        color: #f9fafb;
        font-weight: 600;
        margin-top: 1.5rem;
        margin-bottom: 0.75rem;
        line-height: 1.25;
    }
    
    .prose h1 {
        font-size: 2rem;
        color: #f9fafb;
        margin-top: 2rem;
        margin-bottom: 1rem;
        padding-bottom: 0.5rem;
        border-bottom: 3px solid #374151;
    }
    
    .prose h2 {
        font-size: 1.5rem;
        color: #f9fafb;
        margin-top: 1.5rem;
        margin-bottom: 0.75rem;
        padding-bottom: 0.5rem;
        border-bottom: 2px solid #374151;
    }
    
    .prose h3 {
        font-size: 1.25rem;
        color: #f9fafb;
        margin-top: 1.25rem;
        margin-bottom: 0.5rem;
    }
    
    .prose h4 {
        font-size: 1.125rem;
        color: #f9fafb;
        margin-top: 1rem;
        margin-bottom: 0.5rem;
    }
    
    .prose p {
        margin-bottom: 1rem;
        color: #d1d5db;
        line-height: 1.6;
    }
    
    .prose a {
        color: #fbbf24;
        text-decoration: none;
        font-weight: 400;
        transition: all 0.3s ease;
    }
    
    .prose a:hover {
        color: #f59e0b;
        text-decoration: underline;
    }
    
    .prose code {
        background-color: #f6f8fa;
        color: #24292f;
        padding: 0.2em 0.4em;
        border-radius: 6px;
        font-size: 85%;
        font-family: ui-monospace, SFMono-Regular, "SF Mono", Consolas, "Liberation Mono", Menlo, monospace;
    }
    
    .prose pre {
        background-color: #f6f8fa;
        border-radius: 6px;
        padding: 16px;
        overflow-x: auto;
        margin: 16px 0;
        font-size: 85%;
        line-height: 1.45;
    }
    
    .prose pre code {
        background-color: transparent;
        color: #24292f;
        padding: 0;
        border-radius: 0;
        font-size: 100%;
    }
    
    .prose blockquote {
        border-left: 0.25em solid #d0d7de;
        padding: 0 1em;
        color: #d1d5db;
        margin: 16px 0;
    }
    
    .prose ul, .prose ol {
        color: #d1d5db;
        margin: 16px 0;
        padding-left: 2em;
    }
    
    .prose li {
        margin: 0.25em 0;
        line-height: 1.5;
    }
    
    .prose li::marker {
        color: #656d76;
    }
    
    .prose strong {
        color: #f9fafb;
        font-weight: 700;
    }
    
    .prose em {
        color: #d1d5db;
        font-style: italic;
    }
    
    .prose img {
        max-width: 100%;
        height: auto;
        border-radius: 6px;
        margin: 16px 0;
    }
    
    .prose table {
        width: 100%;
        border-collapse: collapse;
        margin: 16px 0;
        border: 1px solid #d0d7de;
        border-radius: 6px;
    }
    
    .prose th, .prose td {
        padding: 6px 13px;
        text-align: left;
        border: 1px solid #d0d7de;
    }
    
    .prose th {
        background-color: #f6f8fa;
        color: #24292f;
        font-weight: 600;
    }
    
    .prose td {
        color: #d1d5db;
    }
    
    .prose hr {
        height: 0.25em;
        padding: 0;
        margin: 24px 0;
        background-color: #d0d7de;
        border: 0;
    }
</style>